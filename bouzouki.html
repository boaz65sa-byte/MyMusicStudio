<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1000, initial-scale=1">
    <title>Bouzouki Studio V28 - Fixed & Connected</title>
    <style>
        /* --- 住住 --- */
        body { background:#121212; color:#eee; font-family:'Segoe UI',sans-serif; margin:0; padding:10px; height:100vh; overflow:hidden; display:flex; flex-direction:column; align-items:center; }
        * { box-sizing:border-box; user-select:none; }

        /* --- 转住驻转 砖: 住专  注 (专/专/转) --- */
        .top-nav { width: 980px; display: flex; gap: 10px; margin-bottom: 5px; justify-content: flex-end; z-index: 100; }
        .nav-btn { text-decoration:none; font-size:14px; background:#333; color:white; padding:4px 10px; border-radius:4px; border:1px solid #555; cursor: pointer; display:flex; align-items:center; gap:5px; }
        .nav-btn:hover { background: #555; border-color: #999; }

        /* --- 驻转专 --- */
        button, select, input { height:32px; padding:0 10px; border-radius:4px; font-size:13px; border:1px solid #555; background:#333; color:white; outline:none; cursor:pointer; }
        .btn-gold { background:#ffb300; color:black; font-weight:bold; border:none; } .btn-gold:hover{background:#ffca28;}
        .btn-act { background:#455a64; border-color:#607d8b; min-width:35px; } .btn-act:hover{background:#29b6f6; color:black;}
        
        .btn-edit { background:#222; border:2px solid #d32f2f; color:#ef9a9a; width:100%; margin-top:5px; transition:0.3s; font-weight:bold;}
        .btn-edit.active { background:#d32f2f; color:white; box-shadow:0 0 15px #d32f2f; animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0%{box-shadow:0 0 0 #d32f2f;} 50%{box-shadow:0 0 10px #d32f2f;} 100%{box-shadow:0 0 0 #d32f2f;} }

        /* --- 注 --- */
        .top-bar { background:#1e1e1e; padding:8px 15px; border-radius:8px; border:1px solid #333; display:flex; gap:10px; align-items:center; margin-bottom:15px; box-shadow:0 4px 10px rgba(0,0,0,.5); width:980px; justify-content:center; z-index: 50; }
        
        /* --- 拽 --- */
        .inst-wrap { direction:ltr; display:flex; align-items:center; height:260px; width:980px; flex-shrink:0; box-shadow:0 20px 60px rgba(0,0,0,.9); border-radius:12px; border:5px solid #4e342e; position:relative; background:#080808; overflow:hidden; transition:transform 0.5s; margin-bottom:15px; }
        .inst-wrap.flip { transform: scaleX(-1); }
        .inst-wrap.flip .flip-fix { transform: scaleX(-1); display:inline-flex; justify-content:center; align-items:center; }

        .head { width:100px; height:100%; background:#1a1005; position:relative; z-index:2; border-right:3px solid #000; }
        .nut { width:16px; height:100%; background:linear-gradient(to right, #ddd, #999); z-index:5; }
        .neck { flex:1; height:100%; background:linear-gradient(to bottom,#3e2723,#150d0b); position:relative; }
        .line { position:absolute; top:0; bottom:0; width:3px; background:#888; border-left:1px solid #aaa; }
        .num { position:absolute; bottom:3px; width:20px; margin-left:-10px; font-size:10px; color:#8d6e63; font-weight:bold; text-align:center; display:flex; justify-content:center; }
        .dot { position:absolute; width:14px; height:14px; background:#eee; border-radius:50%; top:50%; margin:-7px; opacity:0.8; box-shadow:0 0 5px rgba(255,255,255,0.2); } 
        .dot.t{top:25%} .dot.b{top:75%}
        .course { position:relative; width:100%; height:25%; display:flex; flex-direction:column; justify-content:space-evenly; padding: 4px 0; }
        .string { width:100%; box-shadow:0 1px 2px rgba(0,0,0,1); border-radius:2px; }
        .str-gold { background: #ffb300; border-bottom:1px solid #e65100; }
        .str-silver { background: #e0e0e0; border-bottom:1px solid #757575; }
        .h-thick { height:4px; } .h-med { height:3px; } .h-thin { height:2px; }
        .char { position:absolute; left:15px; top:35%; color:#ffb300; font-size:20px; font-weight:bold; font-family:serif; z-index:10; text-shadow:2px 2px 2px black; width: 20px; text-align: center; display:flex; justify-content:center; }
        .marker { position:absolute; width:26px; height:26px; background:radial-gradient(circle,#43a047,#2e7d32); border:2px solid white; border-radius:50%; top:50%; margin:-13px; z-index:20; display:flex; justify-content:center; align-items:center; font-size:11px; font-weight:bold; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.5); }
        .marker.root { background:radial-gradient(circle,#e53935,#b71c1c); z-index:21; }
        .flash { background:#fff!important; box-shadow:0 0 25px #fff; z-index:200; transition:0.1s; }
        .chord-dot { position:absolute; width:28px; height:28px; background:rgba(33,150,243,0.9); border:2px solid #fff; border-radius:50%; top:50%; margin:-14px; z-index:90; pointer-events:none; box-shadow:0 0 15px #2196f3; display:flex; justify-content:center; align-items:center; font-size:11px; color:white; font-weight:bold; }

        /* --- 专 注 --- */
        .workspace { display:flex; gap:15px; width:980px; height:360px; }
        .panel { background:#212121; border:1px solid #333; border-radius:8px; padding:10px; display:flex; flex-direction:column; overflow:hidden; }
        .panel-l { flex:2; } .panel-r { flex:1; min-width:320px; background:#263238; border-color:#455a64; }
        .title { font-size:12px; color:#90a4ae; text-transform:uppercase; margin-bottom:5px; display:flex; justify-content:space-between; border-bottom:1px solid #455a64; padding-bottom:5px; font-weight:bold; }
        .ins-box { background:#000; padding:10px; border-radius:6px; text-align:center; margin-bottom:10px; border:1px solid #546e7a; min-height:140px; display:flex; flex-direction:column; justify-content:center; }
        .ins-name { font-size:26px; font-weight:bold; color:white; margin-bottom:2px; }
        .ins-notes { font-size:14px; color:#b0bec5; letter-spacing:1px; margin-bottom:10px; }
        .chord-grid { display:flex; flex-wrap:wrap; gap:4px; overflow-y:auto; flex:1; align-content:flex-start; padding:5px; background:rgba(0,0,0,.2); max-height:120px; }
        .chord-btn { background:#37474f; border:1px solid #546e7a; color:#eceff1; margin:0; font-weight:bold; width:30%; font-size:12px; padding:8px; transition:0.2s; border-radius:4px; }
        .chord-btn:hover { background:#ffb300; color:black; transform:scale(1.02); }
        .timeline { background:#121212; height:50px; border-radius:4px; border:1px solid #333; display:flex; align-items:center; padding:0 5px; gap:4px; overflow-x:auto; margin-bottom:10px; }
        .seq-item { background:#424242; padding:3px 6px; font-size:11px; min-width:45px; text-align:center; border-radius:3px; border:1px solid #616161; cursor:pointer; position:relative; margin-right:5px; }
        .seq-item.active { background:#ffb300; color:black; transform:scale(1.1); border-color:white; }
        .del-note { position:absolute; top:-8px; right:-8px; background:#d32f2f; color:white; width:16px; height:16px; font-size:12px; line-height:14px; border-radius:50%; display:none; z-index:100; font-weight:bold; border:1px solid white; text-align:center; }
        .seq-item:hover .del-note { display:block; }
        .chord-item { background:#455a64; border-color:#78909c; min-width:60px; position:relative; }
        .chord-item.active { background:#29b6f6; color:black; }
        .chord-item:hover .del-note { display:block; }

        /* --- 转 转驻 砖驻专转 (Floating) --- */
        #rhythmPanel {
            display: none;
            position: absolute;
            top: 60px; right: 20px;
            width: 320px;
            background: rgba(25, 25, 25, 0.98);
            border: 2px solid #ffb300;
            border-radius: 8px;
            padding: 10px;
            z-index: 2000;
            box-shadow: 0 15px 40px rgba(0,0,0,0.9);
        }
        .rhythm-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 5px; margin-bottom: 10px; cursor: move; }
        .rhythm-title { font-weight: bold; color: #ffb300; font-size: 14px; }
        .close-btn { background: none; border: none; color: #fff; font-weight: bold; cursor: pointer; }
        
        .rhythm-controls select, .rhythm-controls input { width: 100%; margin-bottom: 5px; background: #222; }
        .beat-dot { width: 8px; height: 8px; background: #444; border-radius: 50%; display: inline-block; margin: 1px; }
        .beat-dot.active { background: #ffb300; box-shadow: 0 0 5px #ffb300; }
        .beat-dot.strong { width: 10px; height: 10px; } /* 砖 砖 -1 */
        
        /*  MP3 */
        .mp3-zone {
            margin-top: 10px; padding-top: 10px; border-top: 1px dashed #444;
        }
        .file-label {
            display: block; background: #455a64; color: white; padding: 5px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-bottom: 5px; text-align: center;
        }
        .file-label:hover { background: #607d8b; }
        #audioPlayer { width: 100%; height: 30px; margin-top: 5px; }

        #err { display:none; position:fixed; top:0; left:0; width:100%; background:red; color:white; text-align:center; padding:5px; z-index:999; }
    </style>
</head>
<body>

    <div id="err"></div>

    <div class="top-nav">
        <button class="nav-btn" onclick="window.open('tuner.html','T','width=400,height=600')"> 专</button>
        <button class="nav-btn" onclick="window.open('metronome.html','M','width=400,height=600')">憋 专</button>
        <a href="index.html" class="nav-btn" style="background:#d32f2f;"> 爪</a>
    </div>

    <div class="top-bar">
        <div style="display:flex; gap:10px; align-items:center;">
            <label>砖专砖:</label><select id="rootSelect" onchange="run()"></select>
            <label>住:</label><select id="scaleSelect" onchange="run()"></select>
        </div>
        <button class="btn-gold" onclick="run()">注 专祝</button>
